<script>
    // Mobile menu toggle for prospectus page
    document.querySelector('.menu-toggle').addEventListener('click', function() {
        document.querySelector('.nav-menu').classList.toggle('active');
    });
    
    // Debug function
    function debugSystem() {
        const docs = JSON.parse(localStorage.getItem('lovingHeartsDocuments') || '[]');
        console.log('=== DEBUG ===');
        console.log('Documents in localStorage:', docs);
        console.log('Number of docs:', docs.length);
        
        if (docs.length > 0) {
            console.log('First document:', docs[0]);
            console.log('Link valid?', docs[0].link && docs[0].link.trim() !== '');
        }
        return docs;
    }
    
    // Function to get file icon
    function getFileIcon(url) {
        if (!url) return 'fa-file';
        if (url.includes('.pdf') || url.toLowerCase().endsWith('.pdf')) return 'fa-file-pdf';
        if (url.includes('.doc') || url.toLowerCase().endsWith('.doc') || url.toLowerCase().endsWith('.docx')) return 'fa-file-word';
        if (url.includes('.xls') || url.includes('.xlsx')) return 'fa-file-excel';
        if (url.includes('.jpg') || url.includes('.jpeg') || url.includes('.png')) return 'fa-file-image';
        return 'fa-file';
    }
    
    // Function to get file type
    function getFileType(url) {
        if (!url) return 'Unknown';
        if (url.includes('.pdf')) return 'PDF';
        if (url.includes('.doc')) return 'Word';
        if (url.includes('.xls')) return 'Excel';
        if (url.includes('.jpg') || url.includes('.jpeg')) return 'Image';
        if (url.includes('.png')) return 'Image';
        return 'Document';
    }
    
    // Load documents from localStorage
    function loadDocuments() {
        const container = document.getElementById('documentsList');
        const spinner = document.getElementById('loadingSpinner');
        
        // Debug first
        const storedDocs = debugSystem();
        
        // Clear loading spinner after short delay
        setTimeout(() => {
            if (spinner) spinner.style.display = 'none';
            
            if (storedDocs.length === 0) {
                container.innerHTML = `
                    <div class="no-docs">
                        <i class="fas fa-folder-open"></i>
                        <h3>No documents available yet</h3>
                        <p>Documents will appear here once added by admin</p>
                        <div style="margin-top: 20px;">
                            <a href="admin.html" class="btn btn-primary">
                                <i class="fas fa-user-shield"></i> Go to Admin Panel
                            </a>
                        </div>
                        <div style="margin-top: 20px; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <p style="margin: 0; font-size: 0.9rem; color: #666;">
                                <strong>Note:</strong> Admin needs to login and add Google Drive links
                            </p>
                        </div>
                    </div>
                `;
                return;
            }
            
            // Clear and rebuild document list with ONLY admin-added documents
            container.innerHTML = '';
            
            storedDocs.forEach(doc => {
                const hasValidLink = doc.link && doc.link.trim() !== '';
                const icon = getFileIcon(doc.link);
                const fileType = getFileType(doc.link);
                
                const card = document.createElement('div');
                card.className = 'document-card';
                
                card.innerHTML = `
                    <div class="doc-content">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                            <i class="fas ${icon}"></i>
                            <div>
                                <h3 style="margin: 0 0 5px 0;">${doc.title}</h3>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    ${doc.type ? `<span class="doc-badge">${doc.type}</span>` : ''}
                                    ${fileType ? `<span style="font-size: 0.85rem; color: #666;">${fileType}</span>` : ''}
                                    ${doc.date ? `<span style="font-size: 0.85rem; color: #999;">${doc.date}</span>` : ''}
                                </div>
                            </div>
                        </div>
                        <p style="margin: 10px 0 15px 0; color: #555;">${doc.description}</p>
                    </div>
                    <div class="doc-buttons">
                        ${hasValidLink ? `
                            <a href="${doc.link}" 
                               class="download-btn" 
                               target="_blank" 
                               rel="noopener noreferrer">
                                <i class="fas fa-external-link-alt"></i> Open in Google Drive
                            </a>
                            <div class="download-instruction">
                                <i class="fas fa-arrow-down"></i>
                                Click above, then click "Download" in Google Drive
                            </div>
                        ` : `
                            <button class="download-btn disabled" disabled style="opacity: 0.6;">
                                <i class="fas fa-download"></i> Download Not Available
                            </button>
                            <div class="link-warning">
                                <i class="fas fa-exclamation-triangle"></i>
                                Admin needs to add a valid Google Drive link
                            </div>
                        `}
                    </div>
                `;
                
                container.appendChild(card);
            });
        }, 500);
    }
    
    // Also add smooth scrolling for anchor links
    function initSmoothScroll() {
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                if (targetId === '#') return;
                
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 80,
                        behavior: 'smooth'
                    });
                }
            });
        });
    }
    
    // Load documents when page loads
    document.addEventListener('DOMContentLoaded', function() {
        loadDocuments();
        initSmoothScroll();
        
        // Also reload when coming back to page (in case admin added docs)
        window.addEventListener('focus', function() {
            loadDocuments();
        });
    });
</script>
